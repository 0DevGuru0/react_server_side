!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=28)}([function(e,t){e.exports=require("graphql")},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("mongoose")},function(e,t,n){"use strict";var r=n(2),o=n(14),i=n.n(o),a=n(6),u=new r.Schema({name:{type:String,required:!0},email:{type:String,required:!0,unique:!0,lowercase:!0,index:!0,validate:{validator:function(e){return i.a.isEmail(e)},message:"{VALUE} is not a valid {PATH}"}},password:{type:String,required:!0,unique:!0,trim:!0},googleId:{type:String}});u.method("comparePassword",function(e,n){Object(a.compare)(e,this.password,function(e,t){n(e,t)})}),u.pre("save",function(n){var r=this;if(!r.isModified)return n();Object(a.genSalt)(10,function(e,t){if(e)return n("some thing went wrong");Object(a.hash)(r.password,t,function(e,t){if(e)return n("can't hash the password,try again");r.password=t,n()})})});var s=Object(r.model)("user",u);t.a=s},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("body-parser")},function(e,t,n){e.exports=n(26)},function(e,t){e.exports=require("dotenv")},,function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("express-graphql")},function(e,t){e.exports=require("validator")},function(e,t){function s(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}e.exports=function(u){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=u.apply(e,a);function o(e){s(r,t,n,o,i,"next",e)}function i(e){s(r,t,n,o,i,"throw",e)}o(void 0)})}}},function(e,t){e.exports=require("passport-google-oauth20")},function(e,t){e.exports=require("passport-local")},,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(8),u=n.n(r),o=n(15),i=n.n(o),a=n(1),s=n.n(a),c=n(16),l=n(3),f=n(5),p=n.n(f),h=n(17),d=n.n(h);n(9).config({path:p.a.resolve(process.cwd(),"config/keys/.env")}),s.a.serializeUser(function(e,t){t(null,e.id)}),s.a.deserializeUser(function(e,t){l.a.findById(e).then(function(e){t(null,e)})});var g={clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,callbackURL:process.env.GOOGLE_AUTH_SUCCESS_CALLBACK,proxy:!0},v=new c.Strategy(g,function(){var o=i()(u.a.mark(function e(t,n,r,o){var i,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.findOne({googleId:r.id});case 2:if(i=e.sent)return e.abrupt("return",o(null,i));e.next=5;break;case 5:return e.next=7,new l.a({name:r.displayName,email:r.emails[0].value,password:r.id,googleId:r.id}).save();case 7:a=e.sent,o(null,a);case 9:case"end":return e.stop()}},e)}));return function(e,t,n,r){return o.apply(this,arguments)}}()),y=new d.a({usernameField:"email"},function(e,t,r){l.a.findOne({email:e.toLowerCase()},function(e,n){return e?r(e):n?void n.comparePassword(t,function(e,t){return e?r(e):t?r(null,n):r(null,!1,"Invalid_Credential")}):r(null,!1)})});s.a.use(y),s.a.use(v)},function(e,t,n){var r=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=r.regeneratorRuntime&&0<=Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime"),i=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(27),o)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(N,e){!function(e){"use strict";var s,t=Object.prototype,c=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag",a="object"==typeof N,u=e.regeneratorRuntime;if(u)a&&(N.exports=u);else{(u=e.regeneratorRuntime=a?N.exports:{}).wrap=w;var l="suspendedStart",f="suspendedYield",p="executing",h="completed",d={},g={};g[o]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(q([])));y&&y!==t&&c.call(y,o)&&(g=y);var m=O.prototype=b.prototype=Object.create(g);L.prototype=m.constructor=O,O.constructor=L,O[i]=L.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===L||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,O):(e.__proto__=O,i in e||(e[i]="GeneratorFunction")),e.prototype=Object.create(m),e},u.awrap=function(e){return{__await:e}},S(E.prototype),E.prototype[r]=function(){return this},u.AsyncIterator=E,u.async=function(e,t,n,r){var o=new E(w(e,t,n,r));return u.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},S(m),m[i]="Generator",m[o]=function(){return this},m.toString=function(){return"[object Generator]"},u.keys=function(n){var r=[];for(var e in n)r.push(e);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},u.values=q,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=s)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return i.type="throw",i.arg=n,r.next=e,t&&(r.method="next",r.arg=s),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=c.call(o,"catchLoc"),u=c.call(o,"finallyLoc");if(a&&u){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:q(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=s),d}}}function w(e,t,n,r){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),a=new R(r||[]);return i._invoke=function(i,a,u){var s=l;return function(e,t){if(s===p)throw new Error("Generator is already running");if(s===h){if("throw"===e)throw t;return j()}for(u.method=e,u.arg=t;;){var n=u.delegate;if(n){var r=_(n,u);if(r){if(r===d)continue;return r}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(s===l)throw s=h,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);s=p;var o=x(i,a,u);if("normal"===o.type){if(s=u.done?h:f,o.arg===d)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(s=h,u.method="throw",u.arg=o.arg)}}}(e,n,a),i}function x(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function b(){}function L(){}function O(){}function S(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function E(s){var t;this._invoke=function(n,r){function e(){return new Promise(function(e,t){!function t(e,n,r,o){var i=x(s[e],s,n);if("throw"!==i.type){var a=i.arg,u=a.value;return u&&"object"==typeof u&&c.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,r,o)},function(e){t("throw",e,r,o)}):Promise.resolve(u).then(function(e){a.value=e,r(a)},function(e){return t("throw",e,r,o)})}o(i.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}}function _(e,t){var n=e.iterator[t.method];if(n===s){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=s,_(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=x(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=s),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function G(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(G,this),this.reset(!0)}function q(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=s,e.done=!0,e};return r.next=r}}return{next:j}}function j(){return{value:s,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var r=n(4),o=n.n(r),i=n(2),a=n.n(i),u=n(7),s=n.n(u),c=n(1),l=n.n(c),f=n(5),p=n.n(f),h=n(29),d=n.n(h),g=n(11),v=n.n(g),y=n(12),m=n.n(y),w=function(e,t,n){e.user?n():t.status(404).send({error:"You must log in!"})},x={},b=[{id:1,name:"Leanne Graham"},{id:2,name:"Ervin Howell"},{id:3,name:"Clementine Bauch"},{id:4,name:"Patricia Lebsack"},{id:5,name:"Chelsey Dietrich"}],L=[{id:1,name:"Kurtis Weissnat"},{id:2,name:"Nicholas Runolfsdottir"},{id:3,name:"Gelann Reichert"},{id:4,name:"Moriah Stanton"},{id:5,name:"Rey Padberg"}];x.rootPage=function(e,t){var n='\n        <div>\n        You don\'t appear to be logged in.  You can log in by visiting\n        <a href="/auth/google">the Authentication Route</a>. You could\n        also look at details about yourself at <a href="/api/current_user">the Current User route</a>\n        </div>\n    ';e.user&&(n='\n        <div>\n            You appear to be logged in, so you can visit <a href="/admins">the Admins route</a>\n            or you can <a href="/logout">Logout</a>.\n        </div>\n        '),t.send('\n        <div>\n        <h4>Hi!  Welcome to the React SSR API</h4>\n        <div>\n            You can see <a href="/users">the Users route</a>\n        </div>\n        '.concat(n,"\n        </div>\n    "))},x.usersList=function(e,t){t.send(b)},x.logIn=function(e,t){t.send('\n    <html>\n      <body>\n        <a href="auth/google">Login via Google</a>\n      </body>\n    </html>')},x.admins=function(e,t){t.send(L)},x.redirectToRoot=function(e,t){t.redirect("/")},x.logOut=function(e,t){e.logout(),t.redirect("/")};var O=x,S=o.a.Router(),E=l.a.authenticate("google",{scope:["profile","email"]}),_=l.a.authenticate("google");S.get("/auth/google",E),S.get("/api/auth/google/callback",_,O.redirectToRoot),S.get("/auth/google/callback",_,O.redirectToRoot),S.get("/logout",w,O.logOut),S.get("/current_user",w,function(e,t){t.send(e.user)});var G=S,P=o.a.Router();P.get("/",O.rootPage),P.get("/users",O.usersList),P.get("/admins",w,O.admins),P.get("/login",O.logIn);var R=P,q=n(13),j=n.n(q),N=n(0),T=new N.GraphQLObjectType({name:"UserType",fields:{id:{type:N.GraphQLID},name:{type:N.GraphQLString},email:{type:N.GraphQLString}}}),I=new N.GraphQLObjectType({name:"RootQueryType",fields:function(){return{user:{type:T,resolve:function(e,t,n){return n.user}}}}}),k=n(3),Q={SignUp:function(e){var t=e.email,n=e.password,r=e.name,o=e.req;if(!t||!n)throw new Error("type all credentials");return k.a.findOne({email:t}).then(function(e){if(e)throw new Error("Email is in use");return new k.a({email:t,password:n,name:r}).save()}).then(function(r){return new Promise(function(t,n){o.login(r,function(e){return e&&n(e),t(r)})})})},SignIn:function(e){var t=e.email,o=e.password,i=e.req;if(!t&&!o)throw new Error("type all credentials");return new Promise(function(n,r){l.a.authenticate("local",function(e,t){return t?e?r(e):void i.login(t,function(e){return e?r(e):n(t)}):r("you are not registered yet please signUp first")})({body:{email:t,password:o}})})}},U=Q,C=new N.GraphQLObjectType({name:"MutationObserver",fields:function(){return{SignIn:{type:T,args:{email:{type:new N.GraphQLNonNull(N.GraphQLString)},password:{type:new N.GraphQLNonNull(N.GraphQLString)}},resolve:function(e,t,n){var r=t.password,o=t.email;return U.SignIn({email:o,password:r,req:n})}},SignUp:{type:T,args:{name:{type:new N.GraphQLNonNull(N.GraphQLString)},email:{type:new N.GraphQLNonNull(N.GraphQLString)},password:{type:new N.GraphQLNonNull(N.GraphQLString)}},resolve:function(e,t,n){var r=t.email,o=t.password,i=t.name;return U.SignUp({email:r,password:o,name:i,req:n})}},SignOut:{type:T,resolve:function(e,t,n){var r=n.user;return n.logout(),r}}}}}),A=new N.GraphQLSchema({query:I,mutation:C});n(25),a.a.connect(process.env.DB_ADDRESS,{useNewUrlParser:!0}),a.a.connection.on("connected",function(){console.log("connection established successfully")}),a.a.connection.on("error",function(e){console.log("connection to mongo failed "+e)}),a.a.connection.on("disconnected",function(){console.log("mongo db connection closed")}),a.a.set("useCreateIndex",!0),a.a.Promise=global.Promise;var D=o()();n(9).config({path:p.a.resolve(process.cwd(),"config/keys/.env")}),D.use(v()()),D.use(s.a.json()),D.use(s.a.urlencoded({extended:!0}));var F=[process.env.CORS_APPROVED_ADDRESS,"http://localhost:".concat(process.env.PORT)],M={origin:function(e,t){-1===F.indexOf(e)&&e?t(new Error("Not allowed by CORS")):t(null,!0)}};D.use(m()(M));var Y=n(30)(d.a);D.use(d()({secret:"3f9faa8bc0e722172cc0bdafede9f3f217474e47",resave:!1,saveUninitialized:!1,store:new Y({prefix:"session:auth:"}),cookie:{maxAge:2592e6,httpOnly:!0}})),D.use(l.a.initialize()),D.use(l.a.session()),D.use("/graphql",j()({schema:A,graphiql:!0})),D.use("/",G),D.use("/",R),D.listen(process.env.PORT,function(){console.log("[UserManagement]_server is running on port ".concat(process.env.PORT))})},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("connect-redis")}]);